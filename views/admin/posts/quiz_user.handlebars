<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Animated epp</title>
    <link rel="shortcut icon" href="/pic/robot.png" />

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <!--<link href="/css/3-col-portfolio.css" rel="stylesheet">-->

    <!-- Custom styles for this template -->
    <!--<link href="/css/blog-home.css" rel="stylesheet">-->
    <link href="/css/quiz_draft_stylesheet.css" rel="stylesheet">
    <!-- TODO: highlight the correct selection -->
</head>

<body>
{{>home/home-nav}}

    <form>
        {{#question posts TotalMark}}
            {{question}}
        {{/question}}
        <p>Placeholder for questions</p>

        <div id="Mark"  style="display:none;"></div>

        {{#each errors}}
            <div class="alert alert-danger alert-dismissible">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                {{message}}
            </div>
        {{/each}}
        <div  class="form-group" style="display:none;" ><input type="text" cols="30" rows="10" class="form-control" name="questionBank" id='questionBank' value='{{questionBank}}'></div>


    </form>
<div class="card m-3">
<!--<button id="previous">Previous Question</button>-->
<!--<button id="next">Next Question</button>-->
<!-- <button id="submit"  type="submit" data-toggle="modal" data-target="#emptyQuestion">Submit Quiz</button> -->
<!--<button id="checkAnswer">Check you answer</button>-->
</div>
<footer class="footer"><div class="pagination container text-center" id="pagination"></div></footer>


<div class="modal fade" id="emptyQuestion" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">You have not answered all the questions. Are you sure you want to end the quiz?</div>
            <div class="modal-footer">
                <div><a class="btn btn-primary" type="button" data-dismiss="modal" onclick="checkBackEnd();" >Yes</a></div>
                <div><a class="btn btn-secondary" type="button" data-dismiss="modal">No</a></div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    // $('#testing').on('click',(event)=>{
    //     event.preventDefault();
    //     event.stopPropagation();
    // });
    // $('#submit').on('click',(event)=>{
    //     event.preventDefault();
    //     event.stopPropagation();
    // });
    $('#submit').on('click',(event)=>{
        console.log("hello")
        let count =0;
        for(let i=0;i<{{TotalMark}};i++){
            for(let j=0;j<4;j++){
                var ID = i*10+j;
                if(document.getElementById(ID).checked){
                    count ++;
                }
            }
        }
        if(count === {{TotalMark}}){
            $('#submit').removeAttr('data-toggle');
            $('#submit').removeAttr('data-target');
            checkBackEnd();
            console.log('hi')
        }else{
            console.log('no')
        }
    });
    function checkBackEnd() {
        //event.preventDefault();
        //event.stopPropagation();

        var mark =0;
        $.ajax({
            url: '/quiz_landing/answer',
            type:'POST',
            contentType:'application/json',
            data: JSON.stringify({"questionArr": $("#quesionArray").val(),"questionBank":$("#questionBank").val(),"TotalMark":{{TotalMark}} }),
            success:function (res) {
                let arr = res.split(",");
                for(let i=0;i<{{TotalMark}};i++){
                    var pID = 'p' + i;
                    document.getElementById(pID).style.backgroundColor  = 'red';
                    for(let j=0;j<4;j++){
                        var ID = i*10+j;
                        var qID = 'Q' + ID;


                        if(document.getElementById(ID).value == arr[i]){
                            document.getElementById(qID).style.backgroundColor  = 'lightgreen';
                        }
                        if(document.getElementById(ID).checked){
                            if(document.getElementById(ID).value == arr[i]){
                                mark ++;
                                document.getElementById(pID).style.backgroundColor  = 'lightgreen';
                            }else{
                                document.getElementById(qID).style.backgroundColor  = 'red';

                            }
                        }
                    }
                }
            },

        }).done(()=>{
            showSlide(slides.length-1);
            document.getElementById('Mark').innerHTML = `Mark : ${mark}/ {{TotalMark}}`;
            document.getElementById('Mark').style.display ="inline-block";
        });

    }

</script>

<script>


    function dynamicPage(){
        var out ="";
        out += "<a href='#' id='prev-qn' onclick='showPreviousSlide();' >Prev</a>";
        for(let i=0;i<{{TotalMark}};i++){
            var ind = i+1;
            out += "<a href='#' id=p"+ i +" onclick='showSlide("+i+")' class='qnno'>"+ind+"</a>";
        }
        out += "<a href='#' onclick='showNextSlide();' id='next-qn' style='margin-left: 20px; opacity: 1.0; cursor: pointer;'>Next</a>";
        out += "<a href='#' onclick='' id='submit' style='margin-left: 90%; opacity: 1.0; cursor: pointer;'>Submit</a>"
        document.getElementById('pagination').innerHTML = out;
    }
    dynamicPage();
    //const quizContainer = document.getElementById("quiz");
    //const resultsContainer = document.getElementById("results");
    const submitButton = document.getElementById("submit");
    function showSlide(n) {
        let page = "p" + currentSlide;
        document.getElementById(page).classList.remove("active");
        page = "p" + n;
        document.getElementById(page).classList.add("active");
        // page = "p" + n;
        // page.classList.add("qnno active");
        slides[currentSlide].classList.remove("active-slide");
        slides[n].classList.add("active-slide");
        currentSlide = n;
        if (currentSlide === 0) {
            previousButton.style.display = "none";
            checkAnswer.style.display = 'none';
        } else {
            previousButton.style.display = "inline-block";
            checkAnswer.style.display = 'none';
        }

        if (currentSlide === slides.length - 2) {
            nextButton.style.display = "none";
            submitButton.style.display = "inline-block";
            checkAnswer.style.display = 'none';
        }else if(currentSlide === slides.length - 1){
            nextButton.style.display = "none";
            previousButton.style.display = "none";
            submitButton.style.display = "none";
            checkAnswer.style.display ="inline-block";
        }else {
            nextButton.style.display = "inline-block";
            submitButton.style.display = "none";
            checkAnswer.style.display = 'none';
        }
    }

    function showNextSlide() {
        showSlide(currentSlide + 1);
    }

    function showPreviousSlide() {
        showSlide(currentSlide - 1);
    }
    function firstSlide() {
        showSlide(0);
    }
    const previousButton = document.getElementById("previous");
    const nextButton = document.getElementById("next");
    const slides = document.querySelectorAll(".slide");
    const checkAnswer = document.getElementById("checkAnswer");
    let currentSlide = 0;

    showSlide(0);

    // on submit, show results
    //submitButton.addEventListener("click", showResults);
    checkAnswer.addEventListener('click',firstSlide);
    previousButton.addEventListener("click", showPreviousSlide);
    nextButton.addEventListener("click", showNextSlide);
</script>
<!--<script>-->
<!--document.getElementById('t').onclick = function(){-->
<!--document.getElementById('testing').innerHTML= document.getElementsByName('Question0').value;-->
<!--</script>-->




<script type="text/javascript" src="/js/quiz/quiz.js"></script>